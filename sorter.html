<!DOCTYPE html>
<html>
<head>
    <title>Kennzeichenprüfung - DEMO</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
</head>
<body>
    
    <div class="container">
        <div class="row">
            <div class="col">
                
                <div class="alert alert-primary" role="alert" style="margin-top: 5vh;">
                    <h1>Kennzeichenprüfung - DEMO</h1>
                </div>
                <input type="file" class="form-control" id="fileUpload" />
                <button class="btn btn-primary mt-3" id="convertButton">Konvertieren</button>
            </div>
        </div>
        <div class="row mt-5" style="visibility: hidden;" id="table">
            <div class="col">
                <h2>Gültig</h2>
                <table class="table" id="validTable">
                    <thead>
                        <tr>
                            <th>Bezeichner</th>
                            <th>Kennzeichen</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Gültige Einträge werden hier eingefügt -->
                    </tbody>
                </table>
                <button class="btn btn-success" id="downloadValid">Download Gültig</button>
            </div>
            <div class="col">
                <h2>Ungültig</h2>
                <table class="table" id="invalidTable">
                    <thead>
                        <tr>
                            <th>Bezeichner</th>
                            <th>Wert</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ungültige Einträge werden hier eingefügt -->
                    </tbody>
                </table>
                <button class="btn btn-danger" id="downloadInvalid">Download Ungültig</button>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('convertButton').addEventListener('click', function() {
            const fileInput = document.getElementById('fileUpload');
            const file = fileInput.files[0];
            if (!file) {
                alert('Bitte wählen Sie eine Datei aus.');
                return;
            }

            const reader = new FileReader();
            let validLines = '';
            let invalidLines = '';

            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n');
                const regex = /\b[A-ZÄÖÜ]{1,3}-[A-ZÄÖÜ]{1,2}-\d{1,4}[EH]?\b/g;

                const validTableBody = document.getElementById('validTable').getElementsByTagName('tbody')[0];
                const invalidTableBody = document.getElementById('invalidTable').getElementsByTagName('tbody')[0];
                validTableBody.innerHTML = ''; // Tabelleninhalt leeren
                invalidTableBody.innerHTML = ''; // Tabelleninhalt leeren

                lines.forEach(line => {
                    const fields = line.split(';');
                    if (fields.length > 1) {
                        const match = fields[1].match(regex);
                        if (match) {
                            validLines += fields[0] + ";" + match[0] + '\n';
                            validTableBody.innerHTML += `<tr><td>${fields[0]}</td><td>${match[0]}</td></tr>`;
                        } else {
                            invalidLines += fields[0] + ";" + fields[1] + '\n';
                            invalidTableBody.innerHTML += `<tr><td>${fields[0]}</td><td>${fields[1]}</td></tr>`;
                        }
                    }
                });
                document.getElementById("table").removeAttribute("style")
            };

            reader.readAsText(file);

            document.getElementById('downloadValid').onclick = function() {
                download('valid_kennzeichen.csv', validLines);
            };

            document.getElementById('downloadInvalid').onclick = function() {
                download('invalid_kennzeichen.csv', invalidLines);
            };
        });

        function download(filename, text) {
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);

            element.style.display = 'none';
            document.body.appendChild(element);

            element.click();

            document.body.removeChild(element);
        }
    </script>
</body>
</html>
